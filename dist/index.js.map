{"version":3,"file":"index.js","sources":["../src/tools/Utils.js","../src/tools/constants.js","../src/tools/MonthStructure.js","../src/tools/Processing.js","../src/view/Title.js","../src/context.js","../src/view/styledDaysMap.js","../src/view/Day.js","../src/view/Week.js","../src/view/Month.js","../src/Calendar.js","../src/index.js"],"sourcesContent":["export function ucfirst(str) {\n    return `${ str.charAt(0).toUpperCase() }${ str.slice(1) }`;\n}\n\nexport function calcParamsMatrix(date) {\n    // количество дней в указанном месяце\n    const countDays = new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();\n    // индекс первого дня в неделе указанного месяца\n    const indexOfFirstDay = (new Date(date.getFullYear(), date.getMonth(), 1).getDay()) - 1;\n    // высота массива\n    const heightArray = Math.floor((countDays + indexOfFirstDay) / 7) + Number(((countDays + indexOfFirstDay) % 7) > 0);\n    // количество дней в предыдущем месяце\n    const lastDayPrevMonth = new Date(date.getFullYear(), date.getMonth(), 0).getDate();\n    // день, с которого начинается отсчет\n    const startMonth = indexOfFirstDay > 0 ? (new Date(date.setMonth(date.getMonth()-1))) : (new Date(date));\n    const startDay = new Date(startMonth.getFullYear(), startMonth.getMonth(), lastDayPrevMonth - indexOfFirstDay + 1);\n\n    return [\n        countDays,\n        indexOfFirstDay,\n        heightArray,\n        startDay\n    ];\n}\n\nexport function getTitles(data) {\n    return data.reduce((arr, el) => {\n        arr.push(el[0]);\n        return arr;\n    }, []);\n}\n\nexport function getKeyMonth(currentYear, date) {\n    const strMonth = date.toLocaleDateString('ru-RU', { month: 'long' });\n    let keyMonth = ucfirst(strMonth);\n    if (currentYear !== date.getFullYear()) {\n        keyMonth += `'${ date.getFullYear().toString().slice(2, 4) }`;\n    }\n    return keyMonth;\n}\n\nexport function padZero(val) {\n    return String(val).length === 1 ? `0${ val }` : val;\n}\n","export const DAY_STATE_NOT_AVAILABLE = 'not_available';\nexport const DAY_STATE_DISABLE = 'disable';\nexport const DAY_STATE_ACTIVE = 'active';","import {\n    DAY_STATE_NOT_AVAILABLE,\n    DAY_STATE_DISABLE,\n    DAY_STATE_ACTIVE\n} from \"./constants\";\nimport { calcParamsMatrix } from './Utils';\n\nfunction MonthStructure() {\n    this.days = [];\n    this.daysTemp = [];\n}\n\nMonthStructure.prototype.init = function (date) {\n    const [ countDays, indexOfFirstDay, heightArray, startDay ] = calcParamsMatrix(date);\n    const today = new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate());\n\n    for (let i = 0; i < heightArray; i++) {\n        this.days.push(Array(7));\n    }\n\n    for (let i = 0; i < (7 * heightArray); i++) {\n        const nextDay = new Date(startDay);\n        nextDay.setDate(startDay.getDate() + i);\n\n        let day = {\n            state: DAY_STATE_NOT_AVAILABLE,\n            today: Boolean(today.getTime() === nextDay.getTime()),\n            date: `${ nextDay.getFullYear() }-${ nextDay.getMonth() + 1 }-${ nextDay.getDate() }`,\n            day: nextDay.getDate(),\n            payload: null\n        };\n\n        if ((i >= indexOfFirstDay) && (i <= (indexOfFirstDay + countDays - 1))) {\n            day.state = DAY_STATE_DISABLE;\n        }\n\n        this.daysTemp.push(day);\n    }\n};\n\nMonthStructure.prototype.addDay = function (date, payload = null) {\n    const dayNum = date.getDate();\n    const i = this.daysTemp.findIndex(el => (el.state === DAY_STATE_DISABLE && el.day === dayNum));\n    this.daysTemp[i].state = DAY_STATE_ACTIVE;\n    this.daysTemp[i].date = `${ date.getFullYear() }-${ date.getMonth() + 1 }-${ date.getDate() }`;\n    this.daysTemp[i].payload = payload;\n};\n\nMonthStructure.prototype.processDays = function () {\n    let k = 0;\n    for (let i = 0; i < this.days.length; i++) {\n        for (let j = 0; j < 7; j++) {\n            this.days[i][j] = this.daysTemp[k];\n            k++;\n        }\n    }\n};\n\nexport default MonthStructure;\n","import { getKeyMonth, padZero } from './Utils';\nimport MonthStructure from './MonthStructure';\n\nexport const dataProcessing = (data) => {\n    let monthArray = [];\n    try {\n        const currentYear = (new Date()).getFullYear();\n\n        // заполняем пропущенные месяцы\n        const arrForGenerateEmptyMonth = generateArrMonth(data);\n\n        // наполняем месяцы\n        const monthMap = new Map();\n        for (const item of arrForGenerateEmptyMonth) {\n            const date = new Date(item);\n            const keyMonth = getKeyMonth(currentYear, date);\n            const m = addMonth(date);\n            monthMap.set(keyMonth, m);\n        }\n\n        // проставляем активные дни\n        for (const item of data) {\n            const date = new Date(item.date);\n            const keyMonth = getKeyMonth(currentYear, date);\n            const m = monthMap.get(keyMonth);\n            m.addDay(date, item);\n        }\n\n        // чистим служебные данные\n        monthArray = Array.from(monthMap);\n        monthArray.map(el => {\n            el[1].processDays();\n            delete el[1].daysTemp;\n        });\n    } catch (err) {\n        console.warn(err);\n    }\n\n    return monthArray;\n};\n\nconst addMonth = (date) => {\n    const m = new MonthStructure();\n    m.init(date);\n    return m;\n};\n\nexport const generateArrMonth = (data) => {\n    const month = [];\n    const tmp = [];\n    data.forEach(el => {\n        tmp.push(el.date);\n    });\n\n    tmp.sort();\n    if (tmp.length > 1) {\n        const firstYear = (new Date(tmp[0])).getFullYear();\n        const firstMonth = (new Date(tmp[0])).getMonth() + 1;\n        const lastYear = (new Date(tmp[tmp.length - 1])).getFullYear();\n        const lastMonth = (new Date(tmp[tmp.length - 1])).getMonth() + 1;\n\n        for (let y = firstYear; y <= lastYear; y++) {\n            let startM = 1;\n            let endM = 12;\n            if (y === firstYear) {\n                startM = firstMonth;\n            }\n            if (y === lastYear) {\n                endM = lastMonth;\n            }\n            for (let m = startM; m <= endM; m++) {\n                month.push(`${ y }-${ padZero(m) }-01`);\n            }\n        }\n    } else {\n        month.push(tmp[0]);\n    }\n\n    return month;\n};\n\n","import React from \"react\";\n\nconst Title = ({ titles, monthCount, activeMonth, setActiveMonth }) => {\n    const turnMonth = direction => {\n        if (direction === 'left') {\n            if (activeMonth > 0) {\n                setActiveMonth(activeMonth - 1);\n            }\n        } else {\n            if (activeMonth < monthCount - 1) {\n                setActiveMonth(activeMonth + 1);\n            }\n        }\n    };\n\n    const getClasses = direction => {\n        let classes = 'btn btn-secondary px-2'\n        if (direction === 'left') {\n            if (activeMonth === 0) {\n                classes += ' disabled'\n            }\n        } else {\n            if (activeMonth === monthCount - 1) {\n                classes += ' disabled'\n            }\n        }\n        return classes\n    };\n\n    return (\n        <div className=\"row no-gutters align-items-center mb-4\">\n            <div className=\"col-auto\">\n                <button className={ getClasses('left') } onClick={ () => turnMonth('left') }>\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"none\" viewBox=\"0 0 24 24\"\n                         stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M15 19l-7-7 7-7\"/>\n                    </svg>\n                    <span className=\"sr-only\">Предыдущий месяц</span>\n                </button>\n            </div>\n            <div className=\"col px-3 text-lg text-center font-weight-medium\">{ titles[activeMonth] }</div>\n            <div className=\"col-auto\">\n                <button className={ getClasses('right') } onClick={ () => turnMonth('right') }>\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"none\" viewBox=\"0 0 24 24\"\n                         stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M9 5l7 7-7 7\"/>\n                    </svg>\n                    <span className=\"sr-only\">Следующий месяц</span>\n                </button>\n            </div>\n        </div>\n    );\n};\n\nexport default Title;","import React, { createContext } from 'react';\n\nexport const Context = createContext({});\n\nexport const ContextProvider = ({ children, value }) => {\n    return <Context.Provider value={ value }>{ children }</Context.Provider>;\n};\n","import React from \"react\";\nimport {DAY_STATE_ACTIVE, DAY_STATE_DISABLE, DAY_STATE_NOT_AVAILABLE} from \"../tools/constants\";\n\nconst notAvailableDay = day => {\n    const classes = !day.today ? 'btn btn-lg btn-block disabled px-1' : 'btn btn-lg btn-block border-primary disabled px-1'\n    return <div className={ classes }>{day.day}</div>;\n};\n\nconst disableDay = day => {\n    const classes = !day.today ? 'btn btn-lg btn-block bg-light disabled px-1' : 'btn btn-lg btn-block bg-light border-primary disabled px-1'\n    return <div className={ classes }>{day.day}</div>;\n};\n\nconst activeDay = (day, dayClick) => {\n    const classes = !day.today ? 'btn btn-lg btn-block btn-primary-light px-1' : 'btn btn-lg btn-block btn-primary-light border-primary px-1'\n    return (\n        <button\n            onClick={ dayClick }\n            className={ classes }>\n            { day.day }\n        </button>\n    );\n};\n\nexport const styledDays = () => {\n    const days = new Map();\n    days.set(DAY_STATE_NOT_AVAILABLE, notAvailableDay);\n    days.set(DAY_STATE_DISABLE, disableDay);\n    days.set(DAY_STATE_ACTIVE, activeDay);\n    return days;\n};","import React, { useContext } from 'react';\nimport { Context } from '../context';\nimport { DAY_STATE_ACTIVE } from \"../tools/constants\";\nimport { styledDays } from \"./styledDaysMap\";\n\nconst Day = ({ data }) => {\n    const { onDayClick } = useContext(Context);\n    const days = styledDays();\n\n    const dayClick = () => {\n        if (data.state === DAY_STATE_ACTIVE && typeof onDayClick === 'function') {\n            onDayClick(data.date, data.payload);\n        }\n    };\n\n    return (\n        <div className=\"col px-1\">\n            { (days.get(data.state))(data, dayClick) }\n        </div>\n    );\n};\n\nexport default Day;","import React from 'react';\nimport Day from './Day';\n\nconst Week = ({ data }) => {\n    return (\n        <div className=\"row row-gutter-8 my-2\">\n            { data.map((day, i) => (\n                <Day key={ i } data={ day }/>\n            )) }\n        </div>\n    );\n};\n\nexport default Week;\n","import React from 'react';\nimport Week from './Week';\n\nconst Month = ({ data }) => {\n    return (\n        <div>\n            <div className=\"row no-gutters mb-3 text-xs text-muted text-center\">\n                <div className=\"col\">ПН</div>\n                <div className=\"col\">ВТ</div>\n                <div className=\"col\">СР</div>\n                <div className=\"col\">ЧТ</div>\n                <div className=\"col\">ПТ</div>\n                <div className=\"col\">СБ</div>\n                <div className=\"col\">ВС</div>\n            </div>\n            { data[1].days.map((week, i) => (\n                <Week key={ i } data={ week }/>\n            )) }\n        </div>\n    );\n};\n\nexport default Month;\n","import React, { Fragment, useMemo, useState } from 'react';\nimport { dataProcessing } from './tools/Processing';\nimport { getTitles, getKeyMonth } from \"./tools/Utils\";\nimport Title from './view/Title';\nimport Month from './view/Month';\n\nexport const Calendar = ({ data, shiftToDate }) => {\n    const calendar = useMemo(() => dataProcessing(data), [ data ]);\n    const titles = getTitles(calendar);\n    const monthCount = calendar.length;\n\n    let initActiveMonth = 0;\n    if (typeof shiftToDate === 'string') {\n        try {\n            const keyMonthArray = getKeyMonth((new Date()).getFullYear(), (new Date(shiftToDate)));\n            initActiveMonth = calendar.findIndex(el => el[0] === keyMonthArray);\n        } catch (err) {\n            console.warn(err);\n        }\n    }\n\n    const [ activeMonth, setActiveMonth ] = useState(initActiveMonth);\n\n    return (\n        <div id=\"calendar\" className=\"my-4\">\n            { !!monthCount &&\n                <Fragment>\n                    <Title titles={ titles } monthCount={ monthCount } activeMonth={ activeMonth }\n                           setActiveMonth={ setActiveMonth }/>\n                    <Month data={ calendar[activeMonth] }/>\n                </Fragment>\n            }\n        </div>\n    );\n};\n\n\n","import React from 'react';\nimport { Calendar } from './Calendar';\nimport { ContextProvider } from './context';\n\nexport default function App({ data, shiftToDate, onDayClick }) {\n    return (\n        <ContextProvider value={ { onDayClick } }>\n            <Calendar data={ data } shiftToDate={ shiftToDate } />\n        </ContextProvider>\n    );\n}"],"names":["ucfirst","str","charAt","toUpperCase","slice","calcParamsMatrix","date","countDays","Date","getFullYear","getMonth","getDate","indexOfFirstDay","getDay","heightArray","Math","floor","Number","lastDayPrevMonth","startMonth","setMonth","startDay","getTitles","data","reduce","arr","el","push","getKeyMonth","currentYear","strMonth","toLocaleDateString","month","keyMonth","toString","padZero","val","String","length","DAY_STATE_NOT_AVAILABLE","DAY_STATE_DISABLE","DAY_STATE_ACTIVE","MonthStructure","days","daysTemp","prototype","init","today","i","Array","nextDay","setDate","day","state","Boolean","getTime","payload","addDay","dayNum","findIndex","processDays","k","j","dataProcessing","monthArray","arrForGenerateEmptyMonth","generateArrMonth","monthMap","Map","item","m","addMonth","set","get","from","map","err","console","warn","tmp","forEach","sort","firstYear","firstMonth","lastYear","lastMonth","y","startM","endM","Title","titles","monthCount","activeMonth","setActiveMonth","turnMonth","direction","getClasses","classes","React","Context","createContext","ContextProvider","children","value","notAvailableDay","disableDay","activeDay","dayClick","styledDays","Day","useContext","onDayClick","Week","Month","week","Calendar","shiftToDate","calendar","useMemo","initActiveMonth","keyMonthArray","useState","Fragment","App"],"mappings":"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"}